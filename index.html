<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lotto Sandwicher√≠a | App Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- Configuraci√≥n Mobile-First -->
    <style>
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #FEFBF6; 
            color: #1F2937;
            -webkit-tap-highlight-color: transparent;
        }
        .chart-container { position: relative; width: 100%; height: 250px; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes bounce-short {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-short { animation: bounce-short 0.3s ease-in-out 1; }
        
        @keyframes slide-up {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        input, select { font-size: 16px !important; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        /* Loader para IA */
        .loader-dots {
            display: inline-flex;
            gap: 4px;
        }
        .loader-dots span {
            width: 6px;
            height: 6px;
            background-color: currentColor;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .loader-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loader-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col pb-28 pb-safe">

    <!-- Navbar Sticky -->
    <nav class="sticky top-0 z-40 bg-white/95 backdrop-blur shadow-sm border-b border-orange-100 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-14">
                <div class="flex items-center cursor-pointer" onclick="window.scrollTo(0,0)">
                    <span class="text-xl font-extrabold text-orange-600 tracking-tight">LOTTO</span>
                    <span class="ml-1 text-xs font-semibold text-gray-400 border-l border-gray-300 pl-2">Tabio</span>
                </div>
                <div class="flex space-x-2 overflow-x-auto hide-scrollbar ml-4 py-2">
                    <button onclick="scrollToSection('stars')" class="px-3 py-1.5 bg-orange-50 text-orange-700 rounded-full text-xs font-bold whitespace-nowrap active:bg-orange-200">‚≠ê Favoritos</button>
                    <button onclick="scrollToSection('menu')" class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-xs font-bold whitespace-nowrap active:bg-gray-200">üìú Men√∫</button>
                    <button onclick="scrollToSection('builder')" class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-xs font-bold whitespace-nowrap active:bg-gray-200">üõ†Ô∏è Crear</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-gradient-to-br from-orange-50 to-orange-100 overflow-hidden px-4 py-8 text-center">
        <h1 class="text-3xl font-extrabold text-gray-900 leading-tight">
            Sabor que hace historia <span class="text-orange-600 block text-2xl mt-1">desde 2022</span>
        </h1>
        <p class="text-sm text-gray-600 mt-2 max-w-md mx-auto">
            Pan artesanal y parrilla en Tabio. <br>¬°Pide f√°cil y r√°pido desde tu celular! üì≤
        </p>
    </header>

    <!-- Section: Chef's Recommendations -->
    <section id="stars" class="py-8 bg-white">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center gap-2 mb-6">
                <span class="text-2xl">‚≠ê</span>
                <h2 class="text-xl font-bold text-gray-900">Los M√°s Pedidos</h2>
            </div>

            <div class="space-y-6">
                <!-- Tablita Card -->
                <div class="bg-white rounded-2xl p-5 border-2 border-orange-200 shadow-lg relative overflow-hidden active:scale-[0.98] transition-transform">
                    <div class="absolute top-0 right-0 bg-orange-600 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg uppercase tracking-wider">Top Ventas</div>
                    <div class="flex justify-between items-start">
                        <div class="w-2/3">
                            <h3 class="text-lg font-bold text-gray-900 leading-tight">Tablita de Carnes</h3>
                            <p class="text-xs text-gray-500 mt-1 line-clamp-2">3 Carnes (Res, Pollo, Cerdo), Papas Fritas, salsas y 3 vegetales.</p>
                        </div>
                        <div class="text-4xl">ü•©</div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <div class="inline-flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-1 rounded-md">
                            <span class="text-sm">üíß</span>
                            <span class="text-[10px] font-bold uppercase">Incluye Agua</span>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-xl font-extrabold text-orange-700">$34.900</span>
                            <button onclick="addToCart(100, 'Tablita de Carnes', 34900, false, 'special')" class="bg-orange-600 text-white px-5 py-2 rounded-full text-xs font-bold shadow-md mt-1 active:bg-orange-800">AGREGAR +</button>
                        </div>
                    </div>
                </div>

                <!-- De la Casa Card -->
                <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-md relative active:scale-[0.98] transition-transform">
                    <div class="absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-3 py-1 rounded-bl-lg uppercase tracking-wider">La Joya üëë</div>
                    <div class="flex justify-between items-start">
                        <div class="w-2/3">
                            <h3 class="text-lg font-bold text-gray-900 leading-tight">S√°ndwich De La Casa</h3>
                            <p class="text-xs text-gray-500 mt-1">Carne de res, pechuga gratinada, huevo frito y 3 vegetales frescos.</p>
                        </div>
                        <div class="text-4xl">ü•™</div>
                    </div>
                    <div class="mt-4 flex items-center justify-end">
                        <div class="flex flex-col items-end">
                            <span class="text-xl font-extrabold text-gray-900">$24.900</span>
                            <button onclick="addToCart(1, 'S√°ndwich De La Casa', 24900, false, 'sandwich')" class="bg-gray-900 text-white px-5 py-2 rounded-full text-xs font-bold shadow-md mt-1 active:bg-gray-700">AGREGAR +</button>
                        </div>
                    </div>
                </div>

                <!-- Bowl Fit Card -->
                <div class="bg-white rounded-2xl p-5 border border-green-200 shadow-md relative active:scale-[0.98] transition-transform">
                    <div class="absolute top-0 right-0 bg-green-600 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg uppercase tracking-wider">Fit üå±</div>
                    <div class="flex justify-between items-start">
                        <div class="w-2/3">
                            <h3 class="text-lg font-bold text-gray-900 leading-tight">Bowl de Carnes Fit</h3>
                            <p class="text-xs text-gray-500 mt-1">3 Carnes (Res, Pollo, Cerdo) maduro picado, tomate, cherry, aguacate, semillas de ch√≠a + Agua.</p>
                        </div>
                        <div class="text-4xl">ü•ó</div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <div class="inline-flex items-center gap-1 bg-blue-50 text-blue-700 px-2 py-1 rounded-md">
                            <span class="text-sm">üíß</span>
                            <span class="text-[10px] font-bold uppercase">Incluye Agua</span>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-xl font-extrabold text-green-700">$37.900</span>
                            <button onclick="addToCart(102, 'Bowl Fit', 37900, false, 'special')" class="bg-green-600 text-white px-5 py-2 rounded-full text-xs font-bold shadow-md mt-1 active:bg-green-800">AGREGAR +</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section: Full Menu Explorer -->
    <section id="menu" class="py-10 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Carta Completa</h2>
            
            <div class="flex overflow-x-auto gap-2 pb-4 hide-scrollbar mb-2" id="menu-filters">
                <button class="filter-btn active flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold bg-gray-900 text-white transition shadow-sm" data-category="all">Todo</button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200 transition shadow-sm" data-category="sandwich">S√°ndwiches</button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200 transition shadow-sm" data-category="burger">Hamburguesas</button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200 transition shadow-sm" data-category="sweet">Waffles</button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200 transition shadow-sm" data-category="drinks">Bebidas</button>
            </div>

            <div id="menu-grid" class="grid grid-cols-2 gap-3 sm:gap-6">
                <!-- Items inserted via JS -->
            </div>
        </div>
    </section>

    <!-- Section: Crea el Tuyo Wizard -->
    <section id="builder" class="py-12 bg-white border-t border-gray-100">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-6">
                <span class="bg-orange-100 text-orange-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide">Personalizado</span>
                <h2 class="text-2xl font-bold text-gray-900 mt-2">üõ†Ô∏è Crea Tu S√°ndwich</h2>
                <p class="text-sm text-gray-500">Precio base: <span class="font-bold text-orange-600">$24.900</span></p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden relative">
                <!-- Close Button -->
                <button onclick="scrollToSection('menu')" class="absolute top-2 right-2 z-10 text-red-500 hover:text-red-700 bg-white rounded-full p-2 shadow-sm border border-gray-200" title="Cerrar y volver al men√∫">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between text-xs font-bold text-gray-400">
                    <span id="step-header-1" class="text-orange-600">1. Pan</span>
                    <span id="step-header-2">2. Carnes</span>
                    <span id="step-header-3">3. Salsas</span>
                    <span id="step-header-4">4. Veg</span>
                </div>

                <div class="p-5">
                    <form id="builder-form">
                        <!-- Step 1: Pan -->
                        <div id="step-1" class="builder-step block">
                            <h3 class="text-base font-bold mb-3 text-gray-800">Elige tu Pan:</h3>
                            <div class="space-y-3">
                                <label class="cursor-pointer border rounded-xl p-3 flex items-center gap-3 active:bg-orange-50">
                                    <input type="radio" name="pan" value="Especias" class="accent-orange-600 w-5 h-5" checked>
                                    <div>
                                        <div class="font-bold text-sm">Con Especias</div>
                                        <div class="text-xs text-gray-500">Base de papa y or√©gano</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer border rounded-xl p-3 flex items-center gap-3 active:bg-orange-50">
                                    <input type="radio" name="pan" value="Napolitano" class="accent-orange-600 w-5 h-5">
                                    <div>
                                        <div class="font-bold text-sm">Napolitano</div>
                                        <div class="text-xs text-gray-500">Base de papa, or√©gano y parmesano</div>
                                    </div>
                                </label>
                            </div>
                            
                            <button type="button" onclick="nextStep(2)" class="w-full mt-6 bg-gray-900 text-white py-3 rounded-xl font-bold active:bg-gray-700">Siguiente ‚û°</button>

                            <!-- Gemini AI Chef Interface (Moved below next button) -->
                            <div class="mt-6 mb-2 p-1 bg-gradient-to-r from-orange-400 to-yellow-400 rounded-xl shadow-sm">
                                <div class="bg-white rounded-lg p-3">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-lg">üßë‚Äçüç≥</span>
                                        <h3 class="font-bold text-gray-800 text-sm">Chef Lotto AI</h3>
                                    </div>
                                    <p class="text-[10px] text-gray-500 mb-2">¬øIndeciso? Escribe tu antojo y la IA lo arma:</p>
                                    <div class="flex gap-2">
                                        <input type="text" id="ai-prompt" placeholder="Ej: Picante con mucho queso..." class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-orange-300">
                                        <button type="button" onclick="askChefLotto()" class="bg-gray-900 text-white px-3 py-1.5 rounded-lg font-bold text-xs flex-shrink-0 active:bg-gray-700 flex items-center justify-center min-w-[70px]">
                                            <span id="ai-btn-text">Armar ‚ú®</span>
                                            <div id="ai-loader" class="hidden loader-dots text-white"><span></span><span></span><span></span></div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Proteins (Min 1, Max 2) -->
                        <div id="step-2" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3 text-gray-800">Elige Prote√≠nas (M√≠n 1, M√°x 2):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="protein" value="Pollo" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm font-medium">Pechuga</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="protein" value="Ternera" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm font-medium">Ternera</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="protein" value="Cordero" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm font-medium">Cordero</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="protein" value="Pavo" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm font-medium">Jam√≥n Pavo</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="protein" value="Pernil" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm font-medium">Pernil Cerdo</span></label>
                            </div>
                            <div class="mt-6 flex gap-3">
                                <button type="button" onclick="prevStep(1)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="nextStep(3)" class="w-2/3 bg-gray-900 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button>
                            </div>
                        </div>

                        <!-- Step 3: Sauces (0 to 3) -->
                        <div id="step-3" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3 text-gray-800">Salsas (Opcional, M√°x 3):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Ma√≠z Lotto" class="accent-orange-600 mr-1"><span class="text-sm">Ma√≠z Lotto</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Ajo Lotto" class="accent-orange-600 mr-1"><span class="text-sm">Ajo Lotto</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Showy" class="accent-orange-600 mr-1"><span class="text-sm">Showy</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="BBQ" class="accent-orange-600 mr-1"><span class="text-sm">BBQ</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Chipotle" class="accent-orange-600 mr-1"><span class="text-sm">Chipotle</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Tomate" class="accent-orange-600 mr-1"><span class="text-sm">Salsa de Tomate</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Guacamole" class="accent-orange-600 mr-1"><span class="text-sm">Guacamole</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Pi√±a" class="accent-orange-600 mr-1"><span class="text-sm">Pi√±a</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-orange-50"><input type="checkbox" name="sauce" value="Mayonesa" class="accent-orange-600 mr-1"><span class="text-sm">Mayonesa</span></label>
                            </div>
                            <div class="mt-6 flex gap-3">
                                <button type="button" onclick="prevStep(2)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="nextStep(4)" class="w-2/3 bg-gray-900 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button>
                            </div>
                        </div>

                         <!-- Step 4: Veggies (0 to 3) -->
                         <div id="step-4" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3 text-gray-800">Vegetales (Opcional, M√°x 3):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="Lechuga Fresca" class="accent-green-600 mr-1"><span class="text-sm">Lechuga Fresca</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="R√∫gula" class="accent-green-600 mr-1"><span class="text-sm">R√∫gula</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="Tomate" class="accent-green-600 mr-1"><span class="text-sm">Tomate</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="Pepinillos" class="accent-green-600 mr-1"><span class="text-sm">Pepinillos</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="Cebolla Caramelizada" class="accent-green-600 mr-1"><span class="text-sm">Cebolla Caramel.</span></label>
                                <label class="cursor-pointer border rounded-lg p-2 text-center active:bg-green-50"><input type="checkbox" name="veg" value="Jalape√±os" class="accent-green-600 mr-1"><span class="text-sm">Jalape√±os</span></label>
                            </div>
                            
                            <div class="mt-6 p-3 bg-orange-50 rounded-lg border border-orange-100 text-center">
                                <p class="text-xs text-gray-500 uppercase font-bold">Resumen de tu creaci√≥n:</p>
                                <p class="font-bold text-sm text-gray-900 mt-1 line-clamp-2" id="builder-summary">...</p>
                            </div>

                            <div class="mt-4 flex gap-3">
                                <button type="button" onclick="prevStep(3)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="finishBuilder()" class="w-2/3 bg-orange-600 text-white py-3 rounded-xl font-bold shadow-lg active:bg-orange-800">¬°AGREGAR!</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Section: Data Analysis (Info only) -->
    <section id="analysis" class="py-10 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-xl font-bold text-gray-900 mb-4 text-center">Mejora tu Pedido</h3>
            
            <div class="bg-white rounded-xl border-l-4 border-orange-500 p-4 shadow-sm flex items-center justify-between">
                <div>
                    <h4 class="text-base font-bold text-gray-900">üçü Papas Francesa</h4>
                    <p class="text-xs text-gray-500">¬øPrefieres francesa en tu combo?</p>
                </div>
                <div class="bg-orange-600 px-5 py-3 rounded-xl shadow-lg animate-pulse">
                    <span class="text-xs font-bold text-white block uppercase tracking-wider">Adiciona</span>
                    <span class="text-2xl font-extrabold text-white">+$2.000</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating Cart Button -->
    <div class="fixed bottom-6 right-4 z-50">
        <button onclick="toggleCart()" id="cart-btn" class="bg-gray-900 text-white rounded-full p-0 w-16 h-16 shadow-2xl flex flex-col items-center justify-center transition-transform transform active:scale-95 border-2 border-white">
            <span class="text-2xl">üõí</span>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border border-white">0</span>
        </button>
    </div>

    <!-- Upsell Modal -->
    <div id="upsell-modal" class="fixed inset-0 z-[60] hidden bg-black/70 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white w-full sm:max-w-md rounded-t-3xl sm:rounded-2xl shadow-2xl animate-slide-up overflow-hidden max-h-[90vh] flex flex-col relative">
            <button onclick="closeUpsell()" class="absolute top-3 right-3 z-10 text-gray-400 hover:text-red-500 bg-white/80 rounded-full p-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-orange-50 p-5 text-center border-b border-orange-100 flex-shrink-0">
                <div class="w-12 h-1 bg-orange-200 rounded-full mx-auto mb-3 sm:hidden"></div>
                <div class="text-3xl mb-1">ü•§üçü</div>
                <h3 class="text-xl font-extrabold text-gray-900">¬°Hazlo Combo y Ahorra!</h3>
            </div>
            
            <div class="p-4 space-y-3 overflow-y-auto">
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-xl active:bg-orange-50 transition cursor-pointer" onclick="addComboToCart(20, 'Combo Ligero', 6900)">
                    <div><div class="font-bold text-gray-900 text-sm">Combo Ligero</div><div class="text-[10px] text-gray-500">Gaseosa 250ml + Papas Chip/Platanitos</div></div>
                    <button class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$6.900</button>
                </div>
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-xl active:bg-orange-50 transition cursor-pointer" onclick="addComboToCart(21, 'Combo Tradicional', 8900)">
                    <div><div class="font-bold text-gray-900 text-sm">Combo Tradicional</div><div class="text-[10px] text-gray-500">Gaseosa 400ml + Papas Chip/Platanitos</div></div>
                    <button class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$8.900</button>
                </div>
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-xl active:bg-orange-50 transition cursor-pointer" onclick="addComboToCart(22, 'Combo Natural', 9500)">
                    <div><div class="font-bold text-gray-900 text-sm">Combo Natural</div><div class="text-[10px] text-gray-500">Jugo en Agua + Papas Chip/Platanitos</div></div>
                    <button class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$9.500</button>
                </div>
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-xl active:bg-orange-50 transition cursor-pointer" onclick="addComboToCart(23, 'Combo Cremoso', 10500)">
                    <div><div class="font-bold text-gray-900 text-sm">Combo Cremoso</div><div class="text-[10px] text-gray-500">Jugo en Leche + Papas Chip/Platanitos</div></div>
                    <button class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$10.500</button>
                </div>
            </div>
            
            <div class="p-4 bg-white border-t border-gray-100 flex-shrink-0 pb-safe">
                <button onclick="closeUpsell()" class="w-full bg-white border-2 border-gray-200 text-gray-500 py-3 rounded-xl font-bold text-sm active:bg-gray-100">
                    No gracias, continuar sin combo
                </button>
            </div>
        </div>
    </div>

    <!-- Flavor Modal -->
    <div id="flavor-modal" class="fixed inset-0 z-[80] hidden bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-fade-in-up overflow-hidden relative">
            <button onclick="closeFlavorModal()" class="absolute top-3 right-3 z-10 text-gray-400 hover:text-red-500 bg-white/50 rounded-full p-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-orange-50 p-4 text-center border-b border-orange-100">
                <h3 class="text-xl font-bold text-gray-900">üçì Elige tu sabor</h3>
                <p class="text-sm text-gray-500">¬øCu√°l es tu favorito?</p>
            </div>
            <div class="p-4 grid grid-cols-2 gap-3">
                <button onclick="selectFlavor('Fresa')" class="p-3 border rounded-xl hover:bg-orange-50 hover:border-orange-300 font-bold text-gray-700 transition">üçì Fresa</button>
                <button onclick="selectFlavor('Maracuy√°')" class="p-3 border rounded-xl hover:bg-orange-50 hover:border-orange-300 font-bold text-gray-700 transition">üü° Maracuy√°</button>
                <button onclick="selectFlavor('Mora')" class="p-3 border rounded-xl hover:bg-orange-50 hover:border-orange-300 font-bold text-gray-700 transition">üü£ Mora</button>
                <button onclick="selectFlavor('Lulo')" class="p-3 border rounded-xl hover:bg-orange-50 hover:border-orange-300 font-bold text-gray-700 transition">üü¢ Lulo</button>
            </div>
            <div class="bg-gray-50 p-3 text-center">
                 <button onclick="closeFlavorModal()" class="text-gray-400 hover:text-gray-600 text-sm underline">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Sauce Modal (NEW) -->
    <div id="sauce-modal" class="fixed inset-0 z-[80] hidden bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-fade-in-up overflow-hidden flex flex-col max-h-[85vh] relative">
            <button onclick="closeSauceModal()" class="absolute top-3 right-3 z-10 text-gray-400 hover:text-red-500 bg-white/50 rounded-full p-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-orange-50 p-4 text-center border-b border-orange-100 flex-shrink-0">
                <h3 class="text-xl font-extrabold text-gray-900">ü•£ Elige tus Salsas</h3>
                <p class="text-xs text-gray-500">M√≠nimo 1, M√°ximo 3. ¬°Son deliciosas!</p>
            </div>
            <div class="p-4 overflow-y-auto">
                <div class="grid grid-cols-2 gap-3" id="sauce-modal-list">
                   <!-- Checkboxes injected here -->
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Ma√≠z Lotto" class="accent-orange-600"><span class="text-sm">Ma√≠z Lotto</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Ajo Lotto" class="accent-orange-600"><span class="text-sm">Ajo Lotto</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Showy" class="accent-orange-600"><span class="text-sm">Showy</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="BBQ" class="accent-orange-600"><span class="text-sm">BBQ</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Chipotle" class="accent-orange-600"><span class="text-sm">Chipotle</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Tomate" class="accent-orange-600"><span class="text-sm">Tomate</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Guacamole" class="accent-orange-600"><span class="text-sm">Guacamole</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Pi√±a" class="accent-orange-600"><span class="text-sm">Pi√±a</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-orange-50"><input type="checkbox" name="modal-sauce" value="Mayonesa" class="accent-orange-600"><span class="text-sm">Mayonesa</span></label>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 flex-shrink-0">
                 <button onclick="confirmSauces()" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold shadow-md active:bg-orange-800">Siguiente ‚û°</button>
            </div>
        </div>
    </div>

    <!-- Veggie Modal (NEW) -->
    <div id="veg-modal" class="fixed inset-0 z-[80] hidden bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-fade-in-up overflow-hidden flex flex-col max-h-[85vh] relative">
            <button onclick="closeVegModal()" class="absolute top-3 right-3 z-10 text-gray-400 hover:text-red-500 bg-white/50 rounded-full p-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-green-50 p-4 text-center border-b border-green-100 flex-shrink-0">
                <h3 class="text-xl font-extrabold text-gray-900">ü•ó Elige Vegetales</h3>
                <p class="text-xs text-gray-500">Opcional. M√°ximo 3.</p>
            </div>
            <div class="p-4 overflow-y-auto">
                <div class="grid grid-cols-2 gap-3">
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="Lechuga Fresca" class="accent-green-600"><span class="text-sm">Lechuga</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="R√∫gula" class="accent-green-600"><span class="text-sm">R√∫gula</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="Tomate" class="accent-green-600"><span class="text-sm">Tomate</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="Pepinillos" class="accent-green-600"><span class="text-sm">Pepinillos</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="Cebolla Caramelizada" class="accent-green-600"><span class="text-sm">Cebolla</span></label>
                   <label class="cursor-pointer border rounded-lg p-2 flex items-center gap-2 hover:bg-green-50"><input type="checkbox" name="modal-veg" value="Jalape√±os" class="accent-green-600"><span class="text-sm">Jalape√±os</span></label>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 flex-shrink-0">
                 <button onclick="confirmVeggies()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-md active:bg-green-800">Confirmar y Agregar</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (NEW) -->
    <div id="confirmation-modal" class="fixed inset-0 z-[90] hidden bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-fade-in-up overflow-hidden relative">
            <div class="bg-green-50 p-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">‚úÖ</span>
                </div>
                <h3 class="text-xl font-extrabold text-gray-900 mb-2">¬°Producto Agregado!</h3>
                <p class="text-sm text-gray-600 px-4">¬°Excelente elecci√≥n! ü§§ Ve al carrito para finalizar tu pedido. üí∞üíµ</p>
            </div>
            <div class="p-4">
                <button onclick="closeConfirmation()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold shadow-md hover:bg-gray-800 transition">Entendido</button>
            </div>
        </div>
    </div>

    <!-- AI Suggestion Modal (New) -->
    <div id="ai-modal" class="fixed inset-0 z-[75] hidden bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl animate-fade-in-up overflow-hidden border-2 border-yellow-400">
            <div class="bg-gradient-to-r from-yellow-300 to-orange-400 p-5 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-white/20 blur-xl"></div>
                <div class="relative z-10">
                    <span class="text-4xl block mb-2">üßë‚Äçüç≥‚ú®</span>
                    <h3 class="text-2xl font-extrabold text-gray-900 tracking-tight" id="ai-modal-title">Propuesta del Chef</h3>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <h4 class="font-bold text-lg text-gray-900 mb-1" id="ai-creation-name"></h4>
                    <p class="text-sm text-gray-600 italic border-l-4 border-orange-300 pl-3 py-1" id="ai-creation-reason"></p>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100">
                    <p class="text-xs text-gray-500 uppercase font-bold mb-2 tracking-wider">Ingredientes seleccionados:</p>
                    <ul class="text-sm space-y-1 text-gray-800" id="ai-creation-ingredients">
                        <!-- Injected by JS -->
                    </ul>
                </div>

                <div class="space-y-3">
                    <button onclick="acceptAiRecommendation()" class="w-full bg-green-600 text-white py-3.5 rounded-xl font-extrabold text-base shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2">
                        <span>¬°Lo quiero! üòã</span>
                        <span class="bg-green-700 px-2 py-0.5 rounded-md text-xs">$24.900</span>
                    </button>
                    <button onclick="closeAiModal()" class="w-full text-gray-400 font-medium text-sm hover:text-gray-600">No gracias, intentar de nuevo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 z-[70] hidden bg-white flex flex-col animate-slide-up">
        <div class="p-4 bg-gray-900 text-white flex justify-between items-center shadow-md flex-shrink-0 pt-safe">
            <h2 class="text-lg font-bold">Tu Pedido Lotto üõí</h2>
            <button onclick="toggleCart()" class="bg-gray-800 p-2 rounded-full text-gray-400 hover:text-white">‚úï</button>
        </div>
        
        <div id="cart-items" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50">
            <!-- Items -->
        </div>

        <div class="p-5 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] flex-shrink-0 pb-safe">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-500 font-medium">Total a Pagar</span>
                <span id="cart-total" class="text-3xl font-extrabold text-gray-900">$0</span>
            </div>
            
            <div class="space-y-3 mb-4">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">üë§</span>
                    <input type="text" id="client-name" placeholder="Tu Nombre Completo" class="w-full pl-10 p-3 bg-gray-50 border border-gray-200 rounded-xl font-medium focus:ring-2 focus:ring-orange-500 outline-none">
                </div>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-orange-500 z-10">üí∏</span>
                    <select id="payment-method" class="w-full pl-10 p-3 bg-orange-100 border-2 border-orange-500 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-orange-500 outline-none appearance-none cursor-pointer">
                        <option value="Nequi/Daviplata">Transferencia (Nequi/Davi)</option>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta de Cr√©dito">Pago con Tarjeta de Cr√©dito</option>
                    </select>
                    <!-- Custom Arrow Icon -->
                    <span class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-orange-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                    </span>
                </div>
            </div>

            <button onclick="sendToWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2 active:bg-green-600 active:scale-[0.98] transition-transform">
                <span>Enviar Pedido a WhatsApp</span>
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
            </button>
            
            <p class="text-xs text-center text-gray-400 mt-3 font-medium">
                * El precio del pedido no incluye el valor del domicilio.
            </p>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const apiKey = ""; // Leave empty

        const menuItems = [
            { id: 1, name: "De la Casa", price: 24900, desc: "Pan Artesanal, Res, Pechuga Gratinada, Huevo Frito, 3 Vegetales frescos.", cat: "sandwich", tags: ["üëë Favorito"], emoji: "ü•™" },
            { id: 2, name: "Desmechado", price: 24900, desc: "Pan Artesanal, Cerdo Desmechado, Pechuga Gratinada, Huevo Frito, 3 Vegetales frescos.", cat: "sandwich", tags: [], emoji: "üê∑" },
            { id: 3, name: "At√∫n", price: 22900, desc: "Pan Artesanal, At√∫n, Queso Gratinado, Salsas Lotto, 3 Vegetales Frescos.", cat: "sandwich", tags: [], emoji: "üêü" },
            { id: 4, name: "Vegetariano", price: 22900, desc: "100g Champi√±ones, Berenjenas Asadas, Huevo y Vegetales.", cat: "sandwich", tags: ["Nuevo"], emoji: "üçÑ" },
            { id: 5, name: "Fachero", price: 24900, desc: "Pan Artesanal, Res, Ma√≠z Tierno, Chorizo, Queso Gratinado, 3 Vegetales.", cat: "sandwich", tags: [], emoji: "üåΩ" },
            { id: 6, name: "Poderoso", price: 23900, desc: "Pan Artesanal, Pechuga, Huevo Frito, 3 Vegetales seleccionados.", cat: "sandwich", tags: [], emoji: "üí™" },
            { id: 7, name: "Curado", price: 25900, desc: "Pan Artesanal, R√∫gula, Tomates, Jam√≥n Serrano, Tocineta, Queso Gratinado.", cat: "sandwich", tags: ["Premium"], emoji: "üçñ" },
            { id: 8, name: "S√°ndwich de Huevo", price: 19900, desc: "Pan Burger, Huevos, Tocineta, Queso + Caf√©.", cat: "sandwich", tags: ["Todo el d√≠a"], emoji: "ü•™‚òï" },
            { id: 9, name: "Hamburguesa Lotto", price: 26900, desc: "Res, Cerdo, Tocineta, Queso Gratinado, 3 Vegetales.", cat: "burger", tags: [], emoji: "üçî" },
            { id: 10, name: "Hamb. Criolla", price: 26900, desc: "Res, Queso, Chorizo, Maduro, Vegetales.", cat: "burger", tags: [], emoji: "üçñ" },
            { id: 11, name: "Doble Carne", price: 29900, desc: "Doble Res, Tocineta, Queso Gratinado, 3 Vegetales.", cat: "burger", tags: [], emoji: "ü•©" },
            { id: 12, name: "Capricho Dulce", price: 17900, desc: "Wafle con Chocolate y Toppings + Caf√© con Leche.", cat: "sweet", tags: ["Tardeo"], emoji: "üßá" },
            { id: 30, name: "Postre Lotto 10oz", price: 12000, desc: "Crema, Frutos Rojos, Fresa, Ar√°ndanos, Banano, Granola, semillas de Chia.", cat: "sweet", tags: [], emoji: "üç®" },
            { id: 31, name: "Postre Lotto 16oz", price: 19000, desc: "Grande: Crema, Frutos Rojos, Fresa, Ar√°ndanos, Banano, Granola, semillas de Chia.", cat: "sweet", tags: [], emoji: "üç®" },
            { id: 32, name: "Waf. Yuca Tradicional", price: 10000, desc: "Sin gluten. Con bastante queso coste√±o rallado.", cat: "sweet", tags: ["üö´üåæ"], emoji: "üßá" },
            { id: 33, name: "Waf. Yuca c/ Huevo", price: 13000, desc: "Sin gluten. Huevo cocido y queso coste√±o.", cat: "sweet", tags: ["üö´üåæ"], emoji: "ü•ö" },
            { id: 34, name: "Waf. Yuca Napolitano", price: 14000, desc: "Sin gluten. Tomate fresco y queso coste√±o.", cat: "sweet", tags: ["üö´üåæ"], emoji: "üçÖ" },
            { id: 35, name: "Waf. Yuca Frutas", price: 17000, desc: "Sin gluten. Banano, ar√°ndanos, fresa y chocolate.", cat: "sweet", tags: ["üö´üåæ"], emoji: "üçì" },
            { id: 14, name: "Jugo en Leche", price: 6900, desc: "Fresa, Maracuy√°, Mora o Lulo.", cat: "drinks", tags: ["Cremoso"], emoji: "ü•§" },
            { id: 16, name: "Jugo en Agua", price: 4900, desc: "Fresa, Mora, Lulo, Maracuy√°.", cat: "drinks", tags: [], emoji: "ü•§" },
            { id: 15, name: "Limonada Natural", price: 4000, desc: "Refrescante y natural.", cat: "drinks", tags: [], emoji: "üçã" },
            { id: 20, name: "Combo Mini", price: 6900, desc: "Gaseosa 250ml + Papas Chip/Platanitos.", cat: "drinks", tags: ["Combo"], emoji: "ü•§" },
            { id: 21, name: "Combo Pet", price: 8900, desc: "Gaseosa 400ml + Papas Chip/Platanitos.", cat: "drinks", tags: ["Combo"], emoji: "ü•§" },
            { id: 100, name: "Tablita de Carnes", price: 34900, desc: "3 Carnes (Res, Pollo, Cerdo), Papas Fritas, Salsas, 3 Vegetales.", cat: "special", tags: [], emoji: "ü•©" },
            { id: 102, name: "Bowl Fit", price: 37900, desc: "3 Carnes (Res, Pollo, Cerdo) maduro picado, tomate, cherry, aguacate, semillas de ch√≠a + Agua.", cat: "special", tags: [], emoji: "ü•ó" }
        ];

        let cart = [];
        let tempItem = null;
        let aiRecommendation = null;

        function formatCurrency(val) {
            return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 }).format(val);
        }

        function renderMenu(category) {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            
            const filtered = category === 'all' ? menuItems.filter(i => i.cat !== 'special' && !i.tags.includes("Combo")) : menuItems.filter(item => item.cat === category);

            filtered.forEach(item => {
                const tagHTML = item.tags.length > 0 
                    ? `<div class="absolute top-2 right-2 bg-orange-100 text-orange-800 text-[10px] font-bold px-2 py-0.5 rounded-md">${item.tags[0]}</div>` 
                    : '';
                
                const card = `
                    <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm relative flex flex-col justify-between active:scale-[0.98] transition-transform h-full">
                        ${tagHTML}
                        <div>
                            <div class="text-3xl mb-2">${item.emoji}</div>
                            <h3 class="font-bold text-sm text-gray-900 leading-tight">${item.name}</h3>
                            <p class="text-[10px] text-gray-500 mt-1 line-clamp-2">${item.desc}</p>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-50 flex justify-between items-center">
                            <span class="font-bold text-gray-900 text-sm">${formatCurrency(item.price)}</span>
                            <button onclick="addToCart(${item.id}, '${item.name}', ${item.price}, false, '${item.cat}')" class="bg-gray-100 text-gray-600 w-8 h-8 rounded-full flex items-center justify-center font-bold shadow-sm active:bg-gray-300">+</button>
                        </div>
                    </div>
                `;
                grid.insertAdjacentHTML('beforeend', card);
            });
        }

        function scrollToSection(id) {
            const element = document.getElementById(id);
            const y = element.getBoundingClientRect().top + window.scrollY - 70;
            window.scrollTo({top: y, behavior: 'smooth'});
        }

        function addToCart(id, name, price, isCustom = false, category = 'other') {
            if (id === 14 || id === 16) {
                tempItem = { id, name, price, isCustom, category };
                document.getElementById('flavor-modal').classList.remove('hidden');
                return;
            }

            // 2. Sauce check for mains (only if NOT custom)
            if (!isCustom && ['sandwich', 'burger', 'special'].includes(category)) {
                tempItem = { id, name, price, isCustom, category }; 
                document.getElementById('sauce-modal').classList.remove('hidden');
                document.querySelectorAll('input[name="modal-sauce"]').forEach(cb => cb.checked = false);
                return; 
            }

            cart.push({ id, name, price, isCustom });
            updateCartUI();
            
            const btn = document.getElementById('cart-btn');
            btn.classList.add('animate-bounce-short');
            setTimeout(() => btn.classList.remove('animate-bounce-short'), 300);

            if (['sandwich', 'burger', 'special'].includes(category)) {
                setTimeout(() => {
                    document.getElementById('upsell-modal').classList.remove('hidden');
                }, 300);
            }
        }

        function confirmSauces() {
            if(!tempItem) return;

            const selectedSauces = Array.from(document.querySelectorAll('input[name="modal-sauce"]:checked')).map(cb => cb.value);
            
            if(selectedSauces.length < 1) {
               alert("Por favor selecciona al menos una salsa.");
               return;
            } // Min 1 enforced
            
            if(selectedSauces.length > 3) {
                alert("Puedes seleccionar m√°ximo 3 salsas.");
                return;
            }

            // Update item name with sauces only if sauces selected
            if (selectedSauces.length > 0) {
                 const sauceString = selectedSauces.join(', ');
                 tempItem.name = `${tempItem.name} (Salsas: ${sauceString})`;
            }

            // Reset modal checkboxes just in case
             document.querySelectorAll('input[name="modal-sauce"]').forEach(cb => cb.checked = false);
             
            // Hide sauce modal
            document.getElementById('sauce-modal').classList.add('hidden');
            
            // Check if it's a special item (Tablita or Bowl) to skip veggies
            if (tempItem.category === 'special') {
                cart.push(tempItem);
                updateCartUI();
                tempItem = null; // Clear temp
                
                const btn = document.getElementById('cart-btn');
                btn.classList.add('animate-bounce-short');
                setTimeout(() => btn.classList.remove('animate-bounce-short'), 300);

                setTimeout(() => {
                    document.getElementById('upsell-modal').classList.remove('hidden');
                }, 300);
            } else {
                // Open Veggie Modal for sandwiches/burgers
                document.getElementById('veg-modal').classList.remove('hidden');
                // Clear veggies
                document.querySelectorAll('input[name="modal-veg"]').forEach(cb => cb.checked = false);
            }
        }
        
        function confirmVeggies() {
            if(!tempItem) return;
            
            const selectedVeggies = Array.from(document.querySelectorAll('input[name="modal-veg"]:checked')).map(cb => cb.value);
            
            if(selectedVeggies.length > 3) {
                 alert("Puedes seleccionar m√°ximo 3 vegetales.");
                 return;
            }
            
            if (selectedVeggies.length > 0) {
                 const vegString = selectedVeggies.join(', ');
                 tempItem.name = `${tempItem.name} + Veg(${vegString})`;
            }
            
            // Proceed to add to cart
            cart.push(tempItem);
            updateCartUI();
            
            // Cleanup
            document.getElementById('veg-modal').classList.add('hidden');
            tempItem = null;
            
            const btn = document.getElementById('cart-btn');
            btn.classList.add('animate-bounce-short');
            setTimeout(() => btn.classList.remove('animate-bounce-short'), 300);

            // Trigger upsell since it's a main dish
            setTimeout(() => {
                document.getElementById('upsell-modal').classList.remove('hidden');
            }, 300);
        }


        function addComboToCart(id, name, price) {
            cart.push({ id, name, price, isCustom: false });
            updateCartUI();
            closeUpsell();
        }

        function closeUpsell() {
            document.getElementById('upsell-modal').classList.add('hidden');
            showConfirmation(); // Trigger confirmation when closed (after decision)
        }

        function showConfirmation() {
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }

        function closeConfirmation() {
            document.getElementById('confirmation-modal').classList.add('hidden');
        }

        function closeSauceModal() {
            document.getElementById('sauce-modal').classList.add('hidden');
            tempItem = null;
        }

        function closeVegModal() {
            document.getElementById('veg-modal').classList.add('hidden');
            tempItem = null;
        }

        function selectFlavor(flavor) {
            if(tempItem) {
                cart.push({ 
                    id: tempItem.id, 
                    name: `${tempItem.name} - ${flavor}`, 
                    price: tempItem.price, 
                    isCustom: tempItem.isCustom 
                });
                updateCartUI();
                
                const btn = document.getElementById('cart-btn');
                btn.classList.add('animate-bounce-short');
                setTimeout(() => btn.classList.remove('animate-bounce-short'), 300);
                
                closeFlavorModal();
                showConfirmation(); // Also show for drinks
                tempItem = null;
            }
        }

        function closeFlavorModal() {
            document.getElementById('flavor-modal').classList.add('hidden');
            tempItem = null;
        }

        function removeFromCart(nameToRemove) {
            const index = cart.findIndex(item => item.name === nameToRemove);
            if (index > -1) {
                cart.splice(index, 1);
            }
            updateCartUI();
        }

        function updateCartUI() {
            const count = document.getElementById('cart-count');
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            
            count.textContent = cart.length;
            
            let total = 0;
            list.innerHTML = '';
            
            if (cart.length === 0) {
                list.innerHTML = '<div class="text-center py-10 flex flex-col items-center"><span class="text-5xl mb-2">üçΩÔ∏è</span><p class="text-gray-400 text-sm">Tu pedido est√° vac√≠o.</p></div>';
            } else {
                const summary = cart.reduce((acc, item) => {
                    if (!acc[item.name]) {
                        acc[item.name] = { count: 0, price: item.price };
                    }
                    acc[item.name].count++;
                    return acc;
                }, {});

                for (const [name, details] of Object.entries(summary)) {
                    total += details.count * details.price;
                    list.innerHTML += `
                        <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-gray-200 shadow-sm">
                            <div class="flex items-center gap-3">
                                <span class="bg-gray-100 text-gray-800 text-xs font-bold w-6 h-6 flex items-center justify-center rounded-md">${details.count}x</span>
                                <div>
                                    <p class="font-bold text-sm text-gray-900 line-clamp-1">${name}</p>
                                    <p class="text-xs text-orange-600 font-bold">${formatCurrency(details.price * details.count)}</p>
                                </div>
                            </div>
                            <button onclick="removeFromCart('${name}')" class="text-red-400 p-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    `;
                }
                 list.innerHTML += `
                    <div class="text-right mt-2">
                        <button onclick="cart=[]; updateCartUI();" class="text-xs text-red-500 underline">Vaciar Carrito</button>
                    </div>
                `;
            }
            totalEl.textContent = formatCurrency(total);
        }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = 'auto';
            }
        }

        function sendToWhatsApp() {
            if (cart.length === 0) {
                alert("Agrega productos antes de enviar.");
                return;
            }
            
            const name = document.getElementById('client-name').value;
            const method = document.getElementById('payment-method').value;
            
            if (!name) {
                alert("Por favor escribe tu nombre.");
                return;
            }

            let message = `Hola *Lotto Sandwicher√≠a* üëã, mi pedido es:\n\n`;
            message += `üë§ *Cliente:* ${name}\n`;
            message += `üí∏ *Pago:* ${method}\n`;
            message += `----------------------------\n`;

            const summary = cart.reduce((acc, item) => {
                if (!acc[item.name]) { acc[item.name] = { count: 0, price: item.price }; }
                acc[item.name].count++;
                return acc;
            }, {});

            let total = 0;
            for (const [n, details] of Object.entries(summary)) {
                const sub = details.count * details.price;
                message += `‚ñ™Ô∏è ${details.count}x ${n} - ${formatCurrency(sub)}\n`;
                total += sub;
            }

            message += `----------------------------\n`;
            message += `üí∞ *TOTAL: ${formatCurrency(total)}*`;
            
            message += `\n\n*Nota: El valor del domicilio no est√° incluido en este total.*`;

            const phone = "573024830038"; 
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
        }

        const enforceLimit = (name, limit) => {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
            checkboxes.forEach(cb => {
                cb.addEventListener('change', () => {
                    const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
                    if (checked.length > limit) {
                        cb.checked = false;
                        alert(`M√°ximo ${limit} opciones permitidas.`);
                    }
                });
            });
        };
        enforceLimit('protein', 2);
        enforceLimit('sauce', 3);
        enforceLimit('veg', 3);
        
        // Also enforce modal limits (Live Check)
        const enforceModalLimit = (name, limit) => {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
            checkboxes.forEach(cb => {
                cb.addEventListener('change', () => {
                    const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
                    if (checked.length > limit) {
                        cb.checked = false;
                        alert(`M√°ximo ${limit} opciones permitidas.`);
                    }
                });
            });
        };
        enforceModalLimit('modal-sauce', 3);
        enforceModalLimit('modal-veg', 3);

        function nextStep(step) {
            document.querySelectorAll('.builder-step').forEach(el => el.classList.add('hidden'));
            document.getElementById(`step-${step}`).classList.remove('hidden');
            document.getElementById(`step-${step}`).classList.add('block');
            for(let i=1; i<=4; i++) {
                const h = document.getElementById(`step-header-${i}`);
                if(i===step) h.classList.add('text-orange-600'); else h.classList.remove('text-orange-600');
            }
            updateBuilderSummary();
        }
        function prevStep(step) { nextStep(step); }
        
        function updateBuilderSummary() {
            const pan = document.querySelector('input[name="pan"]:checked')?.value || "";
            const prots = Array.from(document.querySelectorAll('input[name="protein"]:checked')).length;
            document.getElementById('builder-summary').textContent = `Pan ${pan} + ${prots} Carnes...`;
        }

        function finishBuilder() {
            const pan = document.querySelector('input[name="pan"]:checked')?.value;
            const proteins = Array.from(document.querySelectorAll('input[name="protein"]:checked')).map(c => c.value);
            const sauces = Array.from(document.querySelectorAll('input[name="sauce"]:checked')).map(c => c.value);
            const veg = Array.from(document.querySelectorAll('input[name="veg"]:checked')).map(c => c.value);

            if(!pan) { alert("Elige un pan (Paso 1)"); nextStep(1); return; }
            if(proteins.length === 0) { alert("Elige al menos 1 prote√≠na (Paso 2)"); nextStep(2); return; }
            if(proteins.length > 2) { alert("M√°ximo 2 prote√≠nas"); nextStep(2); return; }
            if(sauces.length > 3) { alert("M√°ximo 3 salsas"); nextStep(3); return; }
            if(veg.length > 3) { alert("M√°ximo 3 vegetales"); return; }

            let name = `Armado: ${pan} + ${proteins.join('/')}`;
            if(sauces.length) name += ` + Salsas(${sauces.join(',')})`;
            if(veg.length) name += ` + Veg(${veg.join(',')})`;

            addToCart(999, name, 24900, true, 'sandwich');
            document.getElementById('builder-form').reset();
            nextStep(1);
            showConfirmation(); // Trigger confirmation for builder
        }

        async function askChefLotto() {
            const userPrompt = document.getElementById('ai-prompt').value;
            const btnText = document.getElementById('ai-btn-text');
            const loader = document.getElementById('ai-loader');

            if (!userPrompt) {
                alert("Por favor escribe qu√© se te antoja para que el Chef pueda ayudarte.");
                return;
            }

            btnText.classList.add('hidden');
            loader.classList.remove('hidden');

            const systemInstruction = `
            You are the AI Chef of Lotto Sandwicher√≠a. Your goal is to suggest a sandwich combination based on the user's craving.
            Available ingredients:
            Pan: [Especias, Napolitano]
            Proteins (Max 2): [Pollo, Ternera, Cordero, Pavo, Pernil]
            Sauces (Max 3): [Ma√≠z Lotto, Ajo Lotto, Showy, BBQ, Chipotle, Tomate, Guacamole, Pi√±a, Mayonesa]
            Veggies (Max 3): [Lechuga Fresca, R√∫gula, Tomate, Pepinillos, Cebolla Caramelizada, Jalape√±os]

            User input: "${userPrompt}"

            Output ONLY valid JSON format with keys "creative_name" (string), "reason" (string - short explanation why), "pan" (string), "proteins" (array), "sauces" (array), "veg" (array).
            If user input is unclear, make a best guess.
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if (!response.ok) throw new Error('API Error');

                const data = await response.json();
                const suggestion = JSON.parse(data.candidates[0].content.parts[0].text);

                // Populate Modal
                document.getElementById('ai-creation-name').textContent = suggestion.creative_name;
                document.getElementById('ai-creation-reason').textContent = suggestion.reason;
                
                const list = document.getElementById('ai-creation-ingredients');
                list.innerHTML = `
                    <li>üçû <b>Pan:</b> ${suggestion.pan}</li>
                    <li>ü•© <b>Prote√≠nas:</b> ${suggestion.proteins.join(", ")}</li>
                    <li>ü•£ <b>Salsas:</b> ${suggestion.sauces.join(", ") || "Ninguna"}</li>
                    <li>ü•ó <b>Vegetales:</b> ${suggestion.veg.join(", ") || "Ninguno"}</li>
                `;

                // Store in temp global for acceptance
                aiRecommendation = suggestion;

                // Show Modal
                document.getElementById('ai-modal').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert("El Chef est√° ocupado en este momento. ¬°Intenta armarlo t√∫ mismo!");
            } finally {
                btnText.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }

        function acceptAiRecommendation() {
            if (!aiRecommendation) return;

            const { creative_name, pan, proteins, sauces, veg } = aiRecommendation;
            
            let detailedName = `${creative_name} [${pan}, ${proteins.join('+')}`;
            if(sauces.length) detailedName += `, Salsas:${sauces.join('/')}`;
            if(veg.length) detailedName += `, Veg:${veg.join('/')}`;
            detailedName += `]`;

            addToCart(999, detailedName, 24900, true, 'sandwich');
            
            closeAiModal();
            // Reset form just in case
            document.getElementById('builder-form').reset();
            nextStep(1);
            // Clear AI inputs
            document.getElementById('ai-prompt').value = '';
            showConfirmation(); // Trigger confirmation for AI
        }

        function closeAiModal() {
            document.getElementById('ai-modal').classList.add('hidden');
            aiRecommendation = null;
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderMenu('all');
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('bg-gray-900', 'text-white');
                        b.classList.add('bg-white', 'text-gray-600');
                    });
                    e.target.classList.remove('bg-white', 'text-gray-600');
                    e.target.classList.add('bg-gray-900', 'text-white');
                    renderMenu(e.target.dataset.category);
                });
            });
        });
    </script>
</body>
</html>
