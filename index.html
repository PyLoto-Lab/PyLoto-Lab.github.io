<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lotto Sandwicher√≠a | App Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #FEFBF6; 
            color: #1F2937;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes bounce-short {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-short { animation: bounce-short 0.3s ease-in-out 1; }
        
        @keyframes slide-up {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        input, select { font-size: 16px !important; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        .loader-dots { display: inline-flex; gap: 4px; }
        .loader-dots span {
            width: 6px; height: 6px; background-color: currentColor;
            border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both;
        }
        .loader-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loader-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col pb-28 pb-safe">

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-white/95 backdrop-blur shadow-sm border-b border-orange-100">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-14">
                <div class="flex items-center cursor-pointer" onclick="window.scrollTo(0,0)">
                    <span class="text-xl font-extrabold text-orange-600 tracking-tight">LOTTO</span>
                    <span class="ml-1 text-xs font-semibold text-gray-400 border-l border-gray-300 pl-2">Tabio</span>
                </div>
                <div class="flex space-x-2 overflow-x-auto hide-scrollbar ml-4 py-2">
                    <button onclick="scrollToSection('stars')" class="px-3 py-1.5 bg-orange-50 text-orange-700 rounded-full text-xs font-bold whitespace-nowrap">‚≠ê Favoritos</button>
                    <button onclick="scrollToSection('menu')" class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-xs font-bold whitespace-nowrap">üìú Men√∫</button>
                    <button onclick="scrollToSection('builder')" class="px-3 py-1.5 bg-gray-100 text-gray-600 rounded-full text-xs font-bold whitespace-nowrap">üõ†Ô∏è Crear</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <header class="bg-gradient-to-br from-orange-50 to-orange-100 px-4 py-8 text-center">
        <h1 class="text-3xl font-extrabold text-gray-900">Sabor que hace historia <span class="text-orange-600 block text-2xl">desde 2022</span></h1>
        <p class="text-sm text-gray-600 mt-2">Pan artesanal y parrilla en Tabio. ¬°Pide f√°cil por WhatsApp! üì≤</p>
    </header>

    <!-- Recomendados -->
    <section id="stars" class="py-8 bg-white px-4">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">‚≠ê Los M√°s Pedidos</h2>
            <div class="space-y-6">
                <!-- Tablita -->
                <div class="bg-white rounded-2xl p-5 border-2 border-orange-200 shadow-lg relative">
                    <div class="absolute top-0 right-0 bg-orange-600 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg uppercase">Top Ventas</div>
                    <div class="flex justify-between">
                        <div class="w-2/3">
                            <h3 class="text-lg font-bold">Tablita de Carnes</h3>
                            <p class="text-xs text-gray-500 mt-1">3 Carnes (Res, Pollo, Cerdo), Papas Fritas, salsas y 3 vegetales.</p>
                        </div>
                        <div class="text-4xl">ü•©</div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <span class="text-xl font-extrabold text-orange-700">$34.900</span>
                        <button onclick="addToCart(100, 'Tablita de Carnes', 34900, false, 'special')" class="bg-orange-600 text-white px-5 py-2 rounded-full text-xs font-bold shadow-md">AGREGAR +</button>
                    </div>
                </div>
                <!-- De la casa -->
                <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-md">
                    <div class="flex justify-between">
                        <div class="w-2/3">
                            <h3 class="text-lg font-bold">S√°ndwich De La Casa</h3>
                            <p class="text-xs text-gray-500 mt-1">Res, pechuga gratinada, huevo frito y 3 vegetales.</p>
                        </div>
                        <div class="text-4xl">ü•™</div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <span class="text-xl font-extrabold">$24.900</span>
                        <button onclick="addToCart(1, 'S√°ndwich De La Casa', 24900, false, 'sandwich')" class="bg-gray-900 text-white px-5 py-2 rounded-full text-xs font-bold">AGREGAR +</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Men√∫ Completo -->
    <section id="menu" class="py-10 bg-gray-50 px-4">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-xl font-bold mb-4">üìú Carta Completa</h2>
            <div class="flex overflow-x-auto gap-2 pb-4 hide-scrollbar" id="menu-filters">
                <button class="filter-btn active px-4 py-2 rounded-xl text-sm font-bold bg-gray-900 text-white" data-category="all">Todo</button>
                <button class="filter-btn px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200" data-category="sandwich">S√°ndwiches</button>
                <button class="filter-btn px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200" data-category="burger">Hamburguesas</button>
                <button class="filter-btn px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200" data-category="sweet">Waffles/Postres</button>
                <button class="filter-btn px-4 py-2 rounded-xl text-sm font-bold bg-white text-gray-600 border border-gray-200" data-category="drinks">Bebidas</button>
            </div>
            <div id="menu-grid" class="grid grid-cols-2 gap-3 sm:gap-6"></div>
        </div>
    </section>

    <!-- Constructor -->
    <section id="builder" class="py-12 bg-white border-t border-gray-100 px-4">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-6">
                <span class="bg-orange-100 text-orange-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Personalizado</span>
                <h2 class="text-2xl font-bold mt-2">üõ†Ô∏è Crea Tu S√°ndwich</h2>
                <p class="text-sm text-gray-500">Precio base: <span class="font-bold text-orange-600">$24.900</span></p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gray-50 px-4 py-3 border-b flex justify-between text-[10px] font-bold text-gray-400">
                    <span id="step-header-1" class="text-orange-600">1. Pan</span>
                    <span id="step-header-2">2. Carnes</span>
                    <span id="step-header-3">3. Salsas</span>
                    <span id="step-header-4">4. Veg</span>
                </div>

                <div class="p-5">
                    <form id="builder-form">
                        <!-- Step 1 -->
                        <div id="step-1" class="builder-step block">
                            <h3 class="text-base font-bold mb-3">Elige tu Pan:</h3>
                            <div class="space-y-3">
                                <label class="border rounded-xl p-3 flex items-center gap-3"><input type="radio" name="pan" value="Especias" class="w-5 h-5 accent-orange-600" checked> <div><div class="font-bold text-sm">Con Especias</div><div class="text-xs text-gray-500">Base papa y or√©gano</div></div></label>
                                <label class="border rounded-xl p-3 flex items-center gap-3"><input type="radio" name="pan" value="Napolitano" class="w-5 h-5 accent-orange-600"> <div><div class="font-bold text-sm">Napolitano</div><div class="text-xs text-gray-500">Queso parmesano y or√©gano</div></div></label>
                            </div>
                            <button type="button" onclick="nextStep(2)" class="w-full mt-6 bg-gray-900 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button>
                            
                            <!-- AI Chef -->
                            <div class="mt-6 bg-gradient-to-r from-orange-400 to-yellow-400 p-0.5 rounded-xl">
                                <div class="bg-white p-3 rounded-[10px]">
                                    <div class="flex items-center gap-2 mb-1"><span class="text-lg">üßë‚Äçüç≥</span><h3 class="font-bold text-sm">Chef Lotto AI</h3></div>
                                    <p class="text-[10px] text-gray-500 mb-2">Escribe tu antojo y la IA arma tu s√°ndwich:</p>
                                    <div class="flex gap-2">
                                        <input type="text" id="ai-prompt" placeholder="Ej: Algo picante con pollo..." class="w-full bg-gray-50 border rounded-lg px-3 py-1.5 text-xs outline-none focus:ring-1 focus:ring-orange-300">
                                        <button type="button" onclick="askChefLotto()" class="bg-gray-900 text-white px-3 rounded-lg font-bold text-xs flex-shrink-0">
                                            <span id="ai-btn-text">Armar ‚ú®</span>
                                            <div id="ai-loader" class="hidden loader-dots"><span></span><span></span><span></span></div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2 -->
                        <div id="step-2" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3">Prote√≠nas (M√≠n 1, M√°x 2):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="border rounded-lg p-2 text-center"><input type="checkbox" name="protein" value="Pollo" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm">Pechuga</span></label>
                                <label class="border rounded-lg p-2 text-center"><input type="checkbox" name="protein" value="Ternera" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm">Ternera</span></label>
                                <label class="border rounded-lg p-2 text-center"><input type="checkbox" name="protein" value="Cordero" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm">Cordero</span></label>
                                <label class="border rounded-lg p-2 text-center"><input type="checkbox" name="protein" value="Pavo" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm">Jam√≥n Pavo</span></label>
                                <label class="border rounded-lg p-2 text-center"><input type="checkbox" name="protein" value="Pernil" class="accent-orange-600 block mx-auto mb-1 w-5 h-5"><span class="text-sm">Pernil Cerdo</span></label>
                            </div>
                            <div class="mt-6 flex gap-3">
                                <button type="button" onclick="prevStep(1)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="nextStep(3)" class="w-2/3 bg-gray-900 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button>
                            </div>
                        </div>

                        <!-- Step 3 (Salsas) -->
                        <div id="step-3" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3">Salsas (M√°x 3):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="Ma√≠z Lotto" class="accent-orange-600"><span class="text-xs">Ma√≠z Lotto</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="Ajo Lotto" class="accent-orange-600"><span class="text-xs">Ajo Lotto</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="Showy" class="accent-orange-600"><span class="text-xs">Showy</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="BBQ" class="accent-orange-600"><span class="text-xs">BBQ</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="Chipotle" class="accent-orange-600"><span class="text-xs">Chipotle</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="sauce" value="Guacamole" class="accent-orange-600"><span class="text-xs">Guacamole</span></label>
                            </div>
                            <div class="mt-6 flex gap-3">
                                <button type="button" onclick="prevStep(2)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="nextStep(4)" class="w-2/3 bg-gray-900 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button>
                            </div>
                        </div>

                        <!-- Step 4 (Veg) -->
                        <div id="step-4" class="builder-step hidden">
                            <h3 class="text-base font-bold mb-3">Vegetales (M√°x 3):</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="Lechuga" class="accent-green-600"><span class="text-xs">Lechuga</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="R√∫gula" class="accent-green-600"><span class="text-xs">R√∫gula</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="Tomate" class="accent-green-600"><span class="text-xs">Tomate</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="Pepinillos" class="accent-green-600"><span class="text-xs">Pepinillos</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="Cebolla Caramelizada" class="accent-green-600"><span class="text-xs">Cebolla</span></label>
                                <label class="border rounded-lg p-2 flex items-center gap-2"><input type="checkbox" name="veg" value="Jalape√±os" class="accent-green-600"><span class="text-xs">Jalape√±os</span></label>
                            </div>
                            <div class="mt-6 flex gap-3">
                                <button type="button" onclick="prevStep(3)" class="w-1/3 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Atr√°s</button>
                                <button type="button" onclick="finishBuilder()" class="w-2/3 bg-orange-600 text-white py-3 rounded-xl font-bold">¬°AGREGAR!</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer with Brand Logo -->
    <footer class="bg-white py-12 px-4 border-t border-orange-50">
        <div class="max-w-7xl mx-auto flex flex-col items-center">
            <div class="text-center mb-6">
                <p class="text-xs font-extrabold text-gray-300 uppercase tracking-[0.2em] mb-2">Dise√±ado y Desarrollado por</p>
                <div class="flex items-center gap-2 group cursor-default">
                    <div class="bg-gray-900 text-white w-8 h-8 rounded-lg flex items-center justify-center font-black text-lg shadow-lg group-hover:bg-orange-600 transition-colors">PL</div>
                    <span class="text-xl font-black text-gray-900 tracking-tighter">PyLoto<span class="text-orange-600">-Lab</span></span>
                </div>
            </div>
            <p class="text-[10px] text-gray-400 font-medium">&copy; 2026 Lotto Sandwicher√≠a. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Floating Cart Button -->
    <div class="fixed bottom-6 right-4 z-50">
        <button onclick="toggleCart()" id="cart-btn" class="bg-gray-900 text-white rounded-full w-16 h-16 shadow-2xl flex flex-col items-center justify-center border-2 border-white relative">
            <span class="text-2xl">üõí</span>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-white">0</span>
        </button>
    </div>

    <!-- Modals -->
    <!-- Upsell -->
    <div id="upsell-modal" class="fixed inset-0 z-[60] hidden bg-black/70 backdrop-blur-sm flex items-end sm:items-center justify-center">
        <div class="bg-white w-full sm:max-w-md rounded-t-3xl sm:rounded-2xl animate-slide-up overflow-hidden">
            <div class="bg-orange-50 p-5 text-center border-b border-orange-100">
                <h3 class="text-xl font-extrabold">¬°Hazlo Combo y Ahorra! üçüü•§</h3>
            </div>
            <div class="p-4 space-y-3">
                <div onclick="addComboToCart(20, 'Combo Ligero', 6900)" class="flex justify-between p-3 border rounded-xl active:bg-orange-50 cursor-pointer">
                    <div><div class="font-bold text-sm">Combo Ligero</div><div class="text-[10px] text-gray-500">Gaseosa 250ml + Papas Chip/Platanitos</div></div>
                    <span class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$6.900</span>
                </div>
                <div onclick="addComboToCart(21, 'Combo Tradicional', 8900)" class="flex justify-between p-3 border rounded-xl active:bg-orange-50 cursor-pointer">
                    <div><div class="font-bold text-sm">Combo Tradicional</div><div class="text-[10px] text-gray-500">Gaseosa 400ml + Papas Chip/Platanitos</div></div>
                    <span class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$8.900</span>
                </div>
                <div onclick="addComboToCart(22, 'Combo Natural', 9500)" class="flex justify-between p-3 border rounded-xl active:bg-orange-50 cursor-pointer">
                    <div><div class="font-bold text-sm">Combo Natural</div><div class="text-[10px] text-gray-500">Jugo en Agua + Papas Chip/Platanitos</div></div>
                    <span class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$9.500</span>
                </div>
                <div onclick="addComboToCart(23, 'Combo Cremoso', 10500)" class="flex justify-between p-3 border rounded-xl active:bg-orange-50 cursor-pointer">
                    <div><div class="font-bold text-sm">Combo Cremoso</div><div class="text-[10px] text-gray-500">Jugo en Leche + Papas Chip/Platanitos</div></div>
                    <span class="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-lg text-xs font-bold">+$10.500</span>
                </div>
                <button onclick="closeUpsell()" class="w-full mt-2 py-3 text-gray-400 text-sm font-bold">No gracias, solo el s√°ndwich</button>
            </div>
        </div>
    </div>

    <!-- Salsas para √≠tems de carta -->
    <div id="sauce-modal" class="fixed inset-0 z-[80] hidden bg-black/70 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-fade-in-up">
            <div class="bg-orange-50 p-4 text-center border-b">
                <h3 class="text-xl font-bold">ü•£ Elige tus Salsas</h3>
                <p class="text-[10px] text-gray-500">Selecciona m√°ximo 3</p>
            </div>
            <div class="p-4 grid grid-cols-2 gap-2" id="sauce-list-modal"></div>
            <div class="p-4 border-t"><button onclick="confirmItemSauces()" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold">Siguiente ‚û°</button></div>
        </div>
    </div>

    <!-- Vegetales para √≠tems de carta -->
    <div id="veg-modal" class="fixed inset-0 z-[80] hidden bg-black/70 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-fade-in-up">
            <div class="bg-green-50 p-4 text-center border-b">
                <h3 class="text-xl font-bold">ü•ó Elige Vegetales</h3>
                <p class="text-[10px] text-gray-500">Opcional. M√°ximo 3</p>
            </div>
            <div class="p-4 grid grid-cols-2 gap-2" id="veg-list-modal"></div>
            <div class="p-4 border-t"><button onclick="confirmItemVeggies()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Confirmar y Agregar</button></div>
        </div>
    </div>

    <!-- Sabores Jugos -->
    <div id="flavor-modal" class="fixed inset-0 z-[80] hidden bg-black/70 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl animate-fade-in-up">
            <div class="bg-orange-50 p-4 text-center border-b"><h3 class="text-xl font-bold">üçì Sabor del Jugo</h3></div>
            <div class="p-4 grid grid-cols-2 gap-3">
                <button onclick="selectFlavor('Fresa')" class="p-3 border rounded-xl hover:bg-orange-50 font-bold">üçì Fresa</button>
                <button onclick="selectFlavor('Maracuy√°')" class="p-3 border rounded-xl hover:bg-orange-50 font-bold">üü° Maracuy√°</button>
                <button onclick="selectFlavor('Mora')" class="p-3 border rounded-xl hover:bg-orange-50 font-bold">üü£ Mora</button>
                <button onclick="selectFlavor('Lulo')" class="p-3 border rounded-xl hover:bg-orange-50 font-bold">üü¢ Lulo</button>
            </div>
        </div>
    </div>

    <!-- Carrito Modal -->
    <div id="cart-modal" class="fixed inset-0 z-[70] hidden bg-white flex flex-col">
        <div class="p-4 bg-gray-900 text-white flex justify-between items-center flex-shrink-0 pt-safe">
            <h2 class="font-bold">Tu Carrito Lotto üõí</h2>
            <button onclick="toggleCart()" class="p-2">‚úï</button>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50"></div>
        <div class="p-5 bg-white border-t pb-safe">
            <div class="flex justify-between items-center mb-4"><span class="text-gray-500">Total</span><span id="cart-total" class="text-2xl font-extrabold text-gray-900">$0</span></div>
            <input type="text" id="client-name" placeholder="Tu Nombre" class="w-full p-3 mb-3 bg-gray-50 border rounded-xl font-medium outline-none">
            <select id="payment-method" class="w-full p-3 mb-4 bg-orange-100 border-2 border-orange-500 rounded-xl font-bold text-gray-900 appearance-none">
                <option value="Transferencia">Nequi / Daviplata</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Tarjeta">Tarjeta de Cr√©dito</option>
            </select>
            <button onclick="sendToWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2">Enviar Pedido a WhatsApp</button>
        </div>
    </div>

    <script>
        const menuItems = [
            { id: 1, name: "De la Casa", price: 24900, desc: "Res, pechuga gratinada, huevo frito, 3 Vegetales.", cat: "sandwich", emoji: "ü•™" },
            { id: 2, name: "Desmechado", price: 24900, desc: "Cerdo desmechado, pechuga gratinada, huevo frito, 3 Vegetales.", cat: "sandwich", emoji: "üê∑" },
            { id: 3, name: "At√∫n", price: 22900, desc: "At√∫n, queso fundido, Salsas Lotto, 3 Vegetales.", cat: "sandwich", emoji: "üêü" },
            { id: 5, name: "Fachero", price: 24900, desc: "Res, Ma√≠z Tierno, Chorizo, Queso fundido, 3 Vegetales.", cat: "sandwich", emoji: "üåΩ" },
            { id: 6, name: "Poderoso", price: 23900, desc: "Pechuga, tocineta, queso, Huevo Frito, 3 Vegetales.", cat: "sandwich", emoji: "üí™" },
            { id: 7, name: "Curado", price: 25900, desc: "Jam√≥n Serrano, Tocineta, R√∫gula, Queso Gratinado.", cat: "sandwich", emoji: "üçñ" },
            { id: 9, name: "Hamburguesa Lotto", price: 26900, desc: "Res, Cerdo, Tocineta, Queso fundido, 3 Vegetales.", cat: "burger", emoji: "üçî" },
            { id: 10, name: "Hamb. Criolla", price: 26900, desc: "Res, Queso, Chorizo, Maduro, Vegetales.", cat: "burger", emoji: "üçñ" },
            { id: 32, name: "Waf. Yuca Tradicional", price: 10000, desc: "Sin gluten. Con bastante queso coste√±o.", cat: "sweet", emoji: "üßá" },
            { id: 30, name: "Postre Lotto 10oz", price: 12000, desc: "Crema, Frutos Rojos, Semillas de Chia.", cat: "sweet", emoji: "üç®" },
            { id: 14, name: "Jugo en Leche", price: 6900, desc: "Variedad de sabores cremosos.", cat: "drinks", emoji: "ü•§" },
            { id: 16, name: "Jugo en Agua", price: 4900, desc: "Variedad de sabores refrescantes.", cat: "drinks", emoji: "ü•§" },
            { id: 15, name: "Limonada Natural", price: 4000, desc: "100% natural.", cat: "drinks", emoji: "üçã" },
            { id: 100, name: "Tablita de Carnes", price: 34900, desc: "3 Carnes, Papas, Salsas, Vegetales.", cat: "special", emoji: "ü•©" },
            { id: 102, name: "Bowl de Carnes Fit", price: 37900, desc: "3 Carnes, maduro, aguacate, chia + Agua.", cat: "special", emoji: "ü•ó" }
        ];

        let cart = [];
        let tempItem = null;

        function formatCurrency(v) { return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 }).format(v); }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            window.scrollTo({ top: el.offsetTop - 70, behavior: 'smooth' });
        }

        function renderMenu(cat) {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            const filtered = cat === 'all' ? menuItems.filter(i => i.cat !== 'special') : menuItems.filter(i => i.cat === cat);
            filtered.forEach(i => {
                grid.innerHTML += `
                    <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm flex flex-col justify-between">
                        <div>
                            <div class="text-3xl mb-2">${i.emoji}</div>
                            <h3 class="font-bold text-sm leading-tight">${i.name}</h3>
                            <p class="text-[10px] text-gray-500 mt-1 line-clamp-2">${i.desc}</p>
                        </div>
                        <div class="mt-3 flex justify-between items-center pt-3 border-t border-gray-50">
                            <span class="font-bold text-sm">${formatCurrency(i.price)}</span>
                            <button onclick="addToCart(${i.id}, '${i.name}', ${i.price}, false, '${i.cat}')" class="bg-gray-100 w-8 h-8 rounded-full font-bold">+</button>
                        </div>
                    </div>
                `;
            });
        }

        function addToCart(id, name, price, isCustom, cat) {
            if (id === 14 || id === 16) {
                tempItem = { id, name, price, isCustom, cat };
                document.getElementById('flavor-modal').classList.remove('hidden');
                return;
            }

            if (!isCustom && (cat === 'sandwich' || cat === 'burger' || cat === 'special')) {
                tempItem = { id, name, price, isCustom, cat };
                openSauceSelection();
                return;
            }

            cart.push({ id, name, price, isCustom });
            updateUI();
            if (cat === 'sandwich' || cat === 'burger') document.getElementById('upsell-modal').classList.remove('hidden');
        }

        const saucesOptions = ["Ma√≠z Lotto", "Ajo Lotto", "Showy", "BBQ", "Chipotle", "Tomate", "Guacamole", "Pi√±a", "Mayonesa"];
        const vegOptions = ["Lechuga", "R√∫gula", "Tomate", "Pepinillos", "Cebolla", "Jalape√±os"];

        function openSauceSelection() {
            const list = document.getElementById('sauce-list-modal');
            list.innerHTML = saucesOptions.map(s => `
                <label class="border p-2 rounded-lg flex items-center gap-2"><input type="checkbox" name="m-sauce" value="${s}" class="accent-orange-600"><span class="text-xs">${s}</span></label>
            `).join('');
            document.getElementById('sauce-modal').classList.remove('hidden');
        }

        function confirmItemSauces() {
            const selected = Array.from(document.querySelectorAll('input[name="m-sauce"]:checked')).map(c => c.value);
            if (selected.length > 3) { alert("M√°ximo 3 salsas"); return; }
            if (selected.length > 0) tempItem.name += ` (Salsas: ${selected.join(', ')})`;
            document.getElementById('sauce-modal').classList.add('hidden');
            if (tempItem.cat === 'special') finishSpecialItem(); else openVegSelection();
        }

        function openVegSelection() {
            const list = document.getElementById('veg-list-modal');
            list.innerHTML = vegOptions.map(v => `
                <label class="border p-2 rounded-lg flex items-center gap-2"><input type="checkbox" name="m-veg" value="${v}" class="accent-green-600"><span class="text-xs">${v}</span></label>
            `).join('');
            document.getElementById('veg-modal').classList.remove('hidden');
        }

        function confirmItemVeggies() {
            const selected = Array.from(document.querySelectorAll('input[name="m-veg"]:checked')).map(c => c.value);
            if (selected.length > 3) { alert("M√°ximo 3 vegetales"); return; }
            if (selected.length > 0) tempItem.name += ` + Veg(${selected.join(', ')})`;
            cart.push(tempItem);
            updateUI();
            document.getElementById('veg-modal').classList.add('hidden');
            document.getElementById('upsell-modal').classList.remove('hidden');
            tempItem = null;
        }

        function finishSpecialItem() {
            cart.push(tempItem);
            updateUI();
            document.getElementById('upsell-modal').classList.remove('hidden');
            tempItem = null;
        }

        function selectFlavor(f) {
            cart.push({ id: tempItem.id, name: `${tempItem.name} - ${f}`, price: tempItem.price, isCustom: false });
            updateUI();
            document.getElementById('flavor-modal').classList.add('hidden');
            tempItem = null;
        }

        function addComboToCart(id, name, price) {
            cart.push({ id, name, price, isCustom: false });
            updateUI();
            closeUpsell();
        }

        function closeUpsell() { document.getElementById('upsell-modal').classList.add('hidden'); }

        function updateUI() {
            const count = document.getElementById('cart-count');
            const totalEl = document.getElementById('cart-total');
            const itemsEl = document.getElementById('cart-items');
            count.textContent = cart.length;
            let total = 0;
            itemsEl.innerHTML = '';
            cart.forEach((i, idx) => {
                total += i.price;
                itemsEl.innerHTML += `<div class="bg-white p-3 rounded-xl border flex justify-between items-center"><div class="w-4/5"><p class="font-bold text-sm leading-tight">${i.name}</p><p class="text-xs text-orange-600 font-bold">${formatCurrency(i.price)}</p></div><button onclick="cart.splice(${idx},1); updateUI();" class="text-red-400">‚úï</button></div>`;
            });
            totalEl.textContent = formatCurrency(total);
        }

        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }

        function sendToWhatsApp() {
            const name = document.getElementById('client-name').value;
            if (!name) return alert("Escribe tu nombre");
            if (cart.length === 0) return alert("Carrito vac√≠o");
            let msg = `Hola *Lotto Tabio* üëã\nPedido de: *${name}*\nPago: *${document.getElementById('payment-method').value}*\n---\n`;
            let total = 0;
            cart.forEach(i => { msg += `‚Ä¢ ${i.name} - ${formatCurrency(i.price)}\n`; total += i.price; });
            msg += `---\n*TOTAL: ${formatCurrency(total)}*`;
            window.open(`https://wa.me/573024830038?text=${encodeURIComponent(msg)}`);
        }

        function nextStep(s) {
            document.querySelectorAll('.builder-step').forEach(el => el.classList.add('hidden'));
            document.getElementById(`step-${s}`).classList.remove('hidden');
            for(let i=1; i<=4; i++) {
                const h = document.getElementById(`step-header-${i}`);
                if(i===s) h.classList.add('text-orange-600'); else h.classList.remove('text-orange-600');
            }
        }
        function prevStep(s) { nextStep(s); }

        function finishBuilder() {
            const pan = document.querySelector('input[name="pan"]:checked').value;
            const prots = Array.from(document.querySelectorAll('input[name="protein"]:checked')).map(c => c.value);
            const sauces = Array.from(document.querySelectorAll('input[name="sauce"]:checked')).map(c => c.value);
            const veg = Array.from(document.querySelectorAll('input[name="veg"]:checked')).map(c => c.value);
            if (prots.length < 1 || prots.length > 2) return alert("Selecciona 1 o 2 prote√≠nas");
            let name = `Armado: ${pan} + ${prots.join('/')}`;
            if (sauces.length) name += ` + Salsas(${sauces.join(',')})`;
            if (veg.length) name += ` + Veg(${veg.join(',')})`;
            addToCart(999, name, 24900, true, 'sandwich');
            document.getElementById('builder-form').reset();
            nextStep(1);
        }

        const enforce = (n, l) => {
            document.querySelectorAll(`input[name="${n}"]`).forEach(cb => {
                cb.addEventListener('change', () => {
                    if (document.querySelectorAll(`input[name="${n}"]:checked`).length > l) {
                        cb.checked = false;
                        alert(`M√°ximo ${l} opciones`);
                    }
                });
            });
        }
        enforce('protein', 2); enforce('sauce', 3); enforce('veg', 3);

        async function askChefLotto() {
            const p = document.getElementById('ai-prompt').value;
            if(!p) return alert("Escribe qu√© se te antoja");
            const btn = document.getElementById('ai-btn-text');
            const ldr = document.getElementById('ai-loader');
            btn.classList.add('hidden'); ldr.classList.remove('hidden');
            const sys = `Suggest a sandwich. Available: Pan[Especias, Napolitano], Proteins(Max 2)[Pollo, Ternera, Cordero, Pavo, Pernil], Sauces(Max 3), Vegs(Max 3). Output JSON: {name, reason, pan, proteins:[], sauces:[], veg:[]}`;
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: p }] }], systemInstruction: { parts: [{ text: sys }] }, generationConfig: { responseMimeType: "application/json" } })
                });
                const d = await res.json();
                const sug = JSON.parse(d.candidates[0].content.parts[0].text);
                if(confirm(`üë®‚Äçüç≥ El Chef sugiere: "${sug.name}"\n${sug.reason}\n\n¬øQuieres agregarlo al carrito?`)) {
                    let n = `IA: ${sug.name} (${sug.pan} + ${sug.proteins.join('/')})`;
                    if(sug.sauces.length) n += ` + Salsas(${sug.sauces.join(',')})`;
                    if(sug.veg.length) n += ` + Veg(${sug.veg.join(',')})`;
                    addToCart(888, n, 24900, true, 'sandwich');
                }
            } catch(e) { alert("El chef est√° ocupado, ¬°intenta de nuevo!"); }
            finally { btn.classList.remove('hidden'); ldr.classList.add('hidden'); }
        }

        window.onload = () => renderMenu('all');
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.onclick = (e) => {
                document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('bg-gray-900', 'text-white'));
                b.classList.add('bg-gray-900', 'text-white');
                renderMenu(b.dataset.category);
            };
        });
    </script>
</body>
</html>
